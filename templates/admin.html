{% extends "base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞{% endblock %}

{% block content %}
<div class="admin-panel">
    <!-- Header -->
    <div class="admin-header text-center py-4 mb-5">
        <h1 class="display-4 fw-bold text-warning mb-3">
            <i class="fas fa-cog me-3"></i>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
        </h1>
        <p class="lead text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü–µ–π –ª–∏–¥–µ—Ä–æ–≤</p>
    </div>

    <!-- Statistics Overview -->
    {% if stats %}
    <div class="stats-overview mb-5">
        <h3 class="section-title mb-4">
            <i class="fas fa-chart-bar text-info me-2"></i>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        </h3>
        <div class="row g-4">
            <div class="col-md-3">
                <div class="admin-stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users text-primary"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ stats.total_players }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="admin-stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-sword text-danger"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ "{:,}".format(stats.total_kills) }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –∫–∏–ª–ª–æ–≤</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="admin-stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-gamepad text-success"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ "{:,}".format(stats.total_games) }}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –∏–≥—Ä</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="admin-stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-bed text-info"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number">{{ stats.total_beds_broken }}</div>
                        <div class="stat-label">–ö—Ä–æ–≤–∞—Ç–µ–π —Å–ª–æ–º–∞–Ω–æ</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Add Player Form -->
    <div class="add-player-section mb-5">
        <h3 class="section-title mb-4">
            <i class="fas fa-user-plus text-success me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞
        </h3>
        <form method="POST" action="{{ url_for('add_player') }}" class="add-player-form">
            <div class="row g-3">
                <!-- Basic Info -->
                <div class="col-md-6">
                    <h5 class="form-section-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h5>
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label required">–ù–∏–∫–Ω–µ–π–º</label>
                            <input type="text" class="form-control" name="nickname" required
                                   placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –∏–≥—Ä–æ–∫–∞" maxlength="20">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–†–æ–ª—å</label>
                            <div class="input-group">
                                <select class="form-select bg-dark text-light border-secondary" id="role" name="role">
                                    <option value="–ò–≥—Ä–æ–∫">–ò–≥—Ä–æ–∫</option>
                                    <option value="VIP">VIP</option>
                                    <option value="Premium">Premium</option>
                                    <option value="–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
                                    <option value="–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                                    <option value="custom">–°–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é —Ä–æ–ª—å</option>
                                </select>
                                <button type="button" class="btn btn-outline-primary" id="customRoleBtn" style="display: none;">
                                    <i class="fas fa-magic me-1"></i>–ù–∞—Å—Ç—Ä–æ–∏—Ç—å
                                </button>

                            </div>
                        </div>
                        <div class="col-6" id="customRoleField" style="display: none;">
                            <label class="form-label">–ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–æ–ª—å</label>
                            <div class="input-group">
                                <input type="text" class="form-control bg-dark text-light border-secondary"
                                       id="custom_role" name="custom_role" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏" readonly>
                                <div class="input-group-text bg-dark border-secondary">
                                    <span id="custom_role_preview">üé≠ –†–æ–ª—å</span>
                                </div>
                            </div>
                            <input type="hidden" id="custom_role_color" name="custom_role_color" value="#ffc107">
                            <input type="hidden" id="custom_role_gradient" name="custom_role_gradient">
                            <input type="hidden" id="custom_role_emoji" name="custom_role_emoji" value="üé≠">
                            <input type="hidden" id="custom_role_animated" name="custom_role_animated" value="false">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–°–µ—Ä–≤–µ—Ä</label>
                            <input type="text" class="form-control" name="server_ip"
                                   placeholder="IP —Å–µ—Ä–≤–µ—Ä–∞">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–¢–∏–ø —Å–∫–∏–Ω–∞</label>
                            <select class="form-select" name="skin_type">
                                <option value="auto">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</option>
                                <option value="steve">–°—Ç–∏–≤</option>
                                <option value="alex">–ê–ª–µ–∫—Å</option>
                            </select>
                        </div>
                        <div class="col-6">
                            <label class="form-label">
                                <input type="checkbox" name="is_premium"> –õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
                            </label>
                            <div class="form-text">–ó–∞–≥—Ä—É–∂–∞—Ç—å —Å–∫–∏–Ω –ø–æ –Ω–∏–∫—É</div>
                        </div>
                    </div>
                </div>

                <!-- Combat Stats -->
                <div class="col-md-6">
                    <h5 class="form-section-title">–ë–æ–µ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                    <div class="row g-3">
                        <div class="col-6">
                            <label class="form-label">–ö–∏–ª–ª—ã</label>
                            <input type="number" class="form-control" name="kills" min="0" value="0">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–§–∏–Ω–∞–ª—å–Ω—ã–µ –∫–∏–ª–ª—ã</label>
                            <input type="number" class="form-control" name="final_kills" min="0" value="0">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–°–º–µ—Ä—Ç–∏</label>
                            <input type="number" class="form-control" name="deaths" min="0" value="0">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–§–∏–Ω–∞–ª—å–Ω—ã–µ —Å–º–µ—Ä—Ç–∏</label>
                            <input type="number" class="form-control" name="final_deaths" min="0" value="0">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–ö—Ä–æ–≤–∞—Ç–∏ —Å–ª–æ–º–∞–Ω–æ</label>
                            <input type="number" class="form-control" name="beds_broken" min="0" value="0">
                        </div>
                    </div>
                </div>

                <!-- Game Stats -->
                <div class="col-md-6">
                    <h5 class="form-section-title">–ò–≥—Ä–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                    <div class="row g-3">
                        <div class="col-6">
                            <label class="form-label">–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ</label>
                            <input type="number" class="form-control" name="games_played" min="0" value="0">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–ü–æ–±–µ–¥—ã</label>
                            <input type="number" class="form-control" name="wins" min="0" value="0">
                        </div>
                        <div class="col-12">
                            <label class="form-label">–û–ø—ã—Ç</label>
                            <input type="number" class="form-control" name="experience" min="0" value="0">
                        </div>
                    </div>
                </div>

                <!-- Resources -->
                <div class="col-md-6">
                    <h5 class="form-section-title">–†–µ—Å—É—Ä—Å—ã</h5>
                    <div class="row g-3">
                        <div class="col-6">
                            <label class="form-label">–ñ–µ–ª–µ–∑–æ</label>
                            <input type="number" class="form-control" name="iron_collected" min="0" value="0">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–ó–æ–ª–æ—Ç–æ</label>
                            <input type="number" class="form-control" name="gold_collected" min="0" value="0">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–ê–ª–º–∞–∑—ã</label>
                            <input type="number" class="form-control" name="diamond_collected" min="0" value="0">
                        </div>
                        <div class="col-6">
                            <label class="form-label">–ò–∑—É–º—Ä—É–¥—ã</label>
                            <input type="number" class="form-control" name="emerald_collected" min="0" value="0">
                        </div>
                        <div class="col-12">
                            <label class="form-label">–ü–æ–∫—É–ø–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</label>
                            <input type="number" class="form-control" name="items_purchased" min="0" value="0">
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="col-12">
                    <button type="submit" class="btn btn-success btn-lg">
                        <i class="fas fa-user-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- Recent Players -->
    {% if recent_players %}
    <div class="recent-players-section mb-5">
        <h3 class="section-title mb-4">
            <i class="fas fa-clock text-warning me-2"></i>–ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∏–≥—Ä–æ–∫–∏
        </h3>
        <div class="table-responsive">
            <table class="table table-dark table-striped">
                <thead class="table-warning">
                    <tr>
                        <th>–ò–≥—Ä–æ–∫</th>
                        <th>–£—Ä–æ–≤–µ–Ω—å</th>
                        <th>–û–ø—ã—Ç</th>
                        <th>K/D</th>
                        <th>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for player in recent_players %}
                    <tr>
                        <td>
                            <div class="player-info">
                                <div class="fw-bold">{{ player.nickname }}</div>
                                <div class="text-muted small">{{ player.role }}</div>
                            </div>
                        </td>
                        <td>
                            <span class="badge bg-warning text-dark fs-6">{{ player.level }}</span>
                        </td>
                        <td class="text-warning">{{ "{:,}".format(player.experience) }}</td>
                        <td>
                            <span class="stat-value {{ 'text-success' if player.kd_ratio >= 1.0 else 'text-danger' }}">
                                {{ player.kd_ratio }}
                            </span>
                        </td>
                        <td class="text-muted small">{{ player.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <a href="{{ url_for('player_profile', player_id=player.id) }}"
                                   class="btn btn-outline-primary">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <button class="btn btn-outline-danger"
                                        onclick="confirmDelete({{ player.id }}, '{{ player.nickname }}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <!-- Admin Actions -->
    <div class="admin-actions">
        <h3 class="section-title mb-4">
            <i class="fas fa-tools text-danger me-2"></i>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
        </h3>
        <div class="row g-3">
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-download text-success"></i>
                    </div>
                    <div class="action-content">
                        <h5>–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h5>
                        <p class="text-muted small">–°–∫–∞—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–∞—Ö</p>
                        <div class="d-flex flex-column gap-2">
                            <a href="{{ url_for('export_leaderboard') }}" class="btn btn-sm btn-info">
                                <i class="fas fa-download me-1"></i>–≠–∫—Å–ø–æ—Ä—Ç CSV
                            </a>
                            <a href="{{ url_for('export_database') }}" class="btn btn-sm btn-warning">
                                <i class="fas fa-database me-1"></i>–≠–∫—Å–ø–æ—Ä—Ç –ë–î (JSON)
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-upload text-success mb-2"></i>
                    </div>
                    <div class="action-content">
                        <h5>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h5>
                        <p class="text-muted small">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏</p>
                        <a href="{{ url_for('import_database') }}" class="btn btn-sm btn-success">
                            <i class="fas fa-upload me-1"></i>–ò–º–ø–æ—Ä—Ç –ë–î
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-gamepad text-warning"></i>
                    </div>
                    <div class="action-content">
                        <h5>–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ</h5>
                        <p class="text-muted">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</p>
                        <form method="POST" action="{{ url_for('init_demo') }}" style="display: inline;">
                            <button type="submit" class="btn btn-warning" onclick="return confirm('–°–æ–∑–¥–∞—Ç—å –¥–µ–º–æ-–∏–≥—Ä–æ–∫–æ–≤ –∏ –∫–≤–µ—Å—Ç—ã?')">
                                <i class="fas fa-magic me-1"></i>–°–æ–∑–¥–∞—Ç—å
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-tasks text-info"></i>
                    </div>
                    <div class="action-content">
                        <h5>–ö–≤–µ—Å—Ç—ã</h5>
                        <p class="text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –∫–≤–µ—Å—Ç–æ–≤</p>
                        <a href="{{ url_for('admin_quests') }}" class="btn btn-info">
                            <i class="fas fa-tasks me-1"></i>–£–ø—Ä–∞–≤–ª—è—Ç—å
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-trophy text-purple"></i>
                    </div>
                    <div class="action-content">
                        <h5>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h5>
                        <p class="text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–æ–π –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</p>
                        <a href="{{ url_for('admin_achievements') }}" class="btn" style="background-color: #6f42c1; color: white;">
                            <i class="fas fa-trophy me-1"></i>–£–ø—Ä–∞–≤–ª—è—Ç—å
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon text-warning glow-effect">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="action-content">
                        <h5>–¢–∏—Ç—É–ª—ã –∏ —Ä–æ–ª–∏</h5>
                        <p class="text-muted">–°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ —Ç–∏—Ç—É–ª–æ–≤</p>
                        <div class="d-flex flex-column gap-2">
                            <a href="{{ url_for('admin_titles') }}" class="btn btn-outline-primary">
                                <i class="fas fa-trophy me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∏—Ç—É–ª–∞–º–∏
                            </a>
                            <a href="{{ url_for('admin_roles') }}" class="btn btn-outline-success">
                                <i class="fas fa-user-tag me-2"></i>{{ 'role_management'|t }}
                            </a>
                            <a href="{{ url_for('admin_badges') }}" class="btn btn-outline-warning">
                                <i class="fas fa-medal me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–π–¥–∂–∞–º–∏
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <div class="action-content">
                        <h5>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h5>
                        <p class="text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏–º –≤–∏–¥–æ–º</p>
                        <div class="d-flex flex-column gap-2">
                            <a href="{{ url_for('admin_themes') }}" class="btn btn-outline-primary">
                                <i class="fas fa-palette me-2"></i>–¢–µ–º—ã
                            </a>
                            <a href="{{ url_for('admin_gradients') }}" class="btn btn-outline-warning">
                                <i class="fas fa-magic me-2"></i>–ì—Ä–∞–¥–∏–µ–Ω—Ç—ã
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-coins text-warning"></i>
                    </div>
                    <div class="action-content">
                        <h5>–≠–∫–æ–Ω–æ–º–∏–∫–∞</h5>
                        <p class="text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–π —ç–∫–æ–Ω–æ–º–∏–∫–æ–π</p>
                        <div class="d-flex flex-column gap-2">
                            <a href="{{ url_for('admin_reputation') }}" class="btn btn-outline-info">
                                <i class="fas fa-star me-2"></i>–†–µ–ø—É—Ç–∞—Ü–∏—è
                            </a>
                            <a href="{{ url_for('admin_shop') }}" class="btn btn-outline-success">
                                <i class="fas fa-store me-2"></i>–ú–∞–≥–∞–∑–∏–Ω
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon text-primary">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="action-content">
                        <h5>–ö–≤–µ—Å—Ç—ã –∏–≥—Ä–æ–∫–æ–≤</h5>
                        <p class="text-muted">–ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∫–≤–µ—Å—Ç–æ–≤</p>
                        <a href="{{ url_for('admin_player_quests') }}" class="btn btn-primary">
                            <i class="fas fa-tasks me-2"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon text-success">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="action-content">
                        <h5>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏–≥—Ä–æ–∫–æ–≤</h5>
                        <p class="text-muted">–ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π</p>
                        <a href="{{ url_for('admin_player_achievements') }}" class="btn btn-success">
                            <i class="fas fa-trophy me-2"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-chart-line text-success"></i>
                    </div>
                    <div class="action-content">
                        <h5>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h5>
                        <p class="text-muted">–ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</p>
                        <a href="{{ url_for('statistics') }}" class="btn btn-success">
                            <i class="fas fa-chart-bar me-1"></i>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="action-card">
                    <div class="action-icon">
                        <i class="fas fa-trash text-danger"></i>
                    </div>
                    <div class="action-content">
                        <h5>–û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É</h5>
                        <p class="text-muted">–£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤</p>
                        <button class="btn btn-danger" onclick="confirmClear()">
                            <i class="fas fa-trash me-1"></i>–û—á–∏—Å—Ç–∏—Ç—å
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∏–≥—Ä–æ–∫–∞ <strong id="deletePlayerName"></strong>?</p>
                <p class="text-muted small">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <form id="deleteForm" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Clear Confirmation Modal -->
<div class="modal fade" id="clearModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title text-danger">–í–Ω–∏–º–∞–Ω–∏–µ!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å <strong>–≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤</strong> –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤!</p>
                <p class="text-danger">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!</p>
                <p>–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ <strong>–û–ß–ò–°–¢–ò–¢–¨</strong>:</p>
                <input type="text" class="form-control" id="clearConfirmation" placeholder="–í–≤–µ–¥–∏—Ç–µ –û–ß–ò–°–¢–ò–¢–¨">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <form method="POST" action="{{ url_for('clear_leaderboard') }}" style="display: inline;">
                    <button type="submit" class="btn btn-danger" id="clearSubmit" disabled>
                        –û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Custom Role Creation Modal -->
<div class="modal fade" id="customRoleModal" tabindex="-1" aria-labelledby="customRoleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark border-secondary">
            <div class="modal-header border-secondary">
                <h5 class="modal-title text-primary" id="customRoleModalLabel">
                    <i class="fas fa-magic me-2"></i>–°–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é —Ä–æ–ª—å
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="modal_role_name" class="form-label">
                                <i class="fas fa-tag me-2"></i>–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏
                            </label>
                            <input type="text" class="form-control bg-secondary text-light border-0"
                                   id="modal_role_name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏" required>
                        </div>

                        <div class="mb-3">
                            <label for="modal_role_emoji" class="form-label">
                                <i class="fas fa-smile me-2"></i>–≠–º–æ–¥–∑–∏
                            </label>
                            <div class="input-group">
                                <input type="text" class="form-control bg-secondary text-light border-0"
                                       id="modal_role_emoji" placeholder="üé≠" maxlength="2">
                                <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">
                                    –í—ã–±—Ä–∞—Ç—å
                                </button>
                                <ul class="dropdown-menu bg-dark">
                                    <li><a class="dropdown-item text-light emoji-option" href="#" data-emoji="üëë">üëë –ö–æ—Ä–æ–Ω–∞</a></li>
                                    <li><a class="dropdown-item text-light emoji-option" href="#" data-emoji="‚≠ê">‚≠ê –ó–≤–µ–∑–¥–∞</a></li>
                                    <li><a class="dropdown-item text-light emoji-option" href="#" data-emoji="üî•">üî• –û–≥–æ–Ω—å</a></li>
                                    <li><a class="dropdown-item text-light emoji-option" href="#" data-emoji="üíé">üíé –ê–ª–º–∞–∑</a></li>
                                    <li><a class="dropdown-item text-light emoji-option" href="#" data-emoji="‚ö°">‚ö° –ú–æ–ª–Ω–∏—è</a></li>
                                    <li><a class="dropdown-item text-light emoji-option" href="#" data-emoji="üé≠">üé≠ –ú–∞—Å–∫–∏</a></li>
                                    <li><a class="dropdown-item text-light emoji-option" href="#" data-emoji="üèÜ">üèÜ –¢—Ä–æ—Ñ–µ–π</a></li>
                                    <li><a class="dropdown-item text-light emoji-option" href="#" data-emoji="üåü">üåü –ó–≤—ë–∑–¥–æ—á–∫–∞</a></li>
                                </ul>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="modal_role_color" class="form-label">
                                <i class="fas fa-palette me-2"></i>–¶–≤–µ—Ç
                            </label>
                            <div class="input-group">
                                <input type="color" class="form-control form-control-color bg-secondary border-0"
                                       id="modal_role_color" value="#ffc107">
                                <div class="input-group-text bg-secondary border-0 text-light" id="color_preview">
                                    #ffc107
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="modal_has_gradient">
                                <label class="form-check-label text-light" for="modal_has_gradient">
                                    <i class="fas fa-gradient me-2"></i>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥—Ä–∞–¥–∏–µ–Ω—Ç
                                </label>
                            </div>
                        </div>

                        <div class="mb-3" id="gradient_end_color_group" style="display: none;">
                            <label for="modal_gradient_end_color" class="form-label">
                                <i class="fas fa-fill-drip me-2"></i>–ö–æ–Ω–µ—á–Ω—ã–π —Ü–≤–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞
                            </label>
                            <div class="input-group">
                                <input type="color" class="form-control form-control-color bg-secondary border-0"
                                       id="modal_gradient_end_color" value="#ff6b35">
                                <div class="input-group-text bg-secondary border-0 text-light" id="gradient_color_preview">
                                    #ff6b35
                                </div>
                            </div>
                        </div>

                        <div class="mb-3" id="gradient_animated_group" style="display: none;">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="modal_gradient_animated">
                                <label class="form-check-label text-light" for="modal_gradient_animated">
                                    <i class="fas fa-sync-alt me-2"></i>–ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="preview-section">
                            <h6 class="text-primary">
                                <i class="fas fa-eye me-2"></i>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                            </h6>
                            <div class="preview-card bg-secondary p-4 rounded">
                                <div class="mb-3">
                                    <small class="text-muted">–í –ª–∏–¥–µ—Ä–±–æ—Ä–¥–µ:</small>
                                    <div class="leaderboard-preview mt-2">
                                        <span id="role_preview_display">üé≠ –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–æ–ª—å</span>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <small class="text-muted">–í –ø—Ä–æ—Ñ–∏–ª–µ:</small>
                                    <div class="profile-preview mt-2">
                                        <div class="player-info d-flex align-items-center">
                                            <img src="https://mc-heads.net/avatar/steve/32" class="rounded me-2" alt="Avatar">
                                            <div>
                                                <div class="fw-bold">–ò–≥—Ä–æ–∫123</div>
                                                <div id="profile_role_preview">üé≠ –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–æ–ª—å</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>–û—Ç–º–µ–Ω–∞
                </button>
                <button type="button" class="btn btn-primary" id="applyCustomRole">
                    <i class="fas fa-check me-2"></i>–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
// Custom Role System
document.addEventListener('DOMContentLoaded', function() {
    const roleSelect = document.getElementById('role');
    const customRoleBtn = document.getElementById('customRoleBtn');
    const customRoleField = document.getElementById('custom_role_field');
    const customRoleModal = new bootstrap.Modal(document.getElementById('customRoleModal'));

    // Show/hide custom role elements
    roleSelect.addEventListener('change', function() {
        if (this.value === 'custom') {
            customRoleBtn.style.display = 'inline-block';
            customRoleField.style.display = 'block';
        } else {
            customRoleBtn.style.display = 'none';
            customRoleField.style.display = 'none';
        }
    });

    // Open custom role modal
    customRoleBtn.addEventListener('click', function() {
        customRoleModal.show();
    });

    // Modal functionality
    const modalRoleName = document.getElementById('modal_role_name');
    const modalRoleEmoji = document.getElementById('modal_role_emoji');
    const modalRoleColor = document.getElementById('modal_role_color');
    const modalHasGradient = document.getElementById('modal_has_gradient');
    const modalGradientEndColor = document.getElementById('modal_gradient_end_color');
    const modalGradientAnimated = document.getElementById('modal_gradient_animated');

    const rolePreviewDisplay = document.getElementById('role_preview_display');
    const profileRolePreview = document.getElementById('profile_role_preview');
    const colorPreview = document.getElementById('color_preview');
    const gradientColorPreview = document.getElementById('gradient_color_preview');

    // Toggle gradient options
    modalHasGradient.addEventListener('change', function() {
        const gradientGroups = document.querySelectorAll('#gradient_end_color_group, #gradient_animated_group');
        gradientGroups.forEach(group => {
            group.style.display = this.checked ? 'block' : 'none';
        });
        updatePreview();
    });

    // Color picker updates
    modalRoleColor.addEventListener('input', function() {
        colorPreview.textContent = this.value;
        updatePreview();
    });

    modalGradientEndColor.addEventListener('input', function() {
        gradientColorPreview.textContent = this.value;
        updatePreview();
    });

    // Real-time preview updates
    [modalRoleName, modalRoleEmoji, modalGradientAnimated].forEach(element => {
        element.addEventListener('input', updatePreview);
        element.addEventListener('change', updatePreview);
    });

    // Emoji selection
    document.querySelectorAll('.emoji-option').forEach(option => {
        option.addEventListener('click', function(e) {
            e.preventDefault();
            modalRoleEmoji.value = this.dataset.emoji;
            updatePreview();
        });
    });

    function updatePreview() {
        const name = modalRoleName.value || '–ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–æ–ª—å';
        const emoji = modalRoleEmoji.value || 'üé≠';
        const color = modalRoleColor.value;
        const hasGradient = modalHasGradient.checked;
        const gradientEndColor = modalGradientEndColor.value;
        const isAnimated = modalGradientAnimated.checked;

        const displayText = `${emoji} ${name}`;

        if (hasGradient) {
            const gradient = `linear-gradient(45deg, ${color}, ${gradientEndColor})`;
            const animationClass = isAnimated ? 'gradient-animated' : '';

            const style = `
                background: ${gradient};
                background-size: 200% 200%;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                font-weight: bold;
                ${isAnimated ? 'animation: gradientShift 3s ease-in-out infinite;' : ''}
            `;

            rolePreviewDisplay.innerHTML = `<span style="${style}" class="role-display custom-role gradient-role ${animationClass}">${displayText}</span>`;
            profileRolePreview.innerHTML = `<span style="${style}" class="role-display custom-role gradient-role ${animationClass}">${displayText}</span>`;
        } else {
            const style = `color: ${color}; font-weight: bold;`;
            rolePreviewDisplay.innerHTML = `<span style="${style}" class="role-display custom-role">${displayText}</span>`;
            profileRolePreview.innerHTML = `<span style="${style}" class="role-display custom-role">${displayText}</span>`;
        }
    }

    // Apply custom role
    document.getElementById('applyCustomRole').addEventListener('click', function() {
        const name = modalRoleName.value;
        const emoji = modalRoleEmoji.value;
        const color = modalRoleColor.value;
        const hasGradient = modalHasGradient.checked;
        const gradientEndColor = modalGradientEndColor.value;
        const isAnimated = modalGradientAnimated.checked;

        if (!name) {
            alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏');
            return;
        }

        // Update form fields
        document.getElementById('custom_role').value = name;
        document.getElementById('custom_role_color').value = color;
        document.getElementById('custom_role_emoji').value = emoji;
        document.getElementById('custom_role_animated').value = isAnimated;

        if (hasGradient) {
            document.getElementById('custom_role_gradient').value = `linear-gradient(45deg, ${color}, ${gradientEndColor})`;
        } else {
            document.getElementById('custom_role_gradient').value = '';
        }

        // Update preview in main form
        const previewSpan = document.getElementById('custom_role_preview');
        previewSpan.textContent = `${emoji} ${name}`;

        if (hasGradient) {
            const gradient = `linear-gradient(45deg, ${color}, ${gradientEndColor})`;
            previewSpan.style.background = gradient;
            previewSpan.style.backgroundSize = '200% 200%';
            previewSpan.style.webkitBackgroundClip = 'text';
            previewSpan.style.webkitTextFillColor = 'transparent';
            previewSpan.style.backgroundClip = 'text';
            previewSpan.style.fontWeight = 'bold';
            if (isAnimated) {
                previewSpan.style.animation = 'gradientShift 3s ease-in-out infinite';
            }
        } else {
            previewSpan.style.color = color;
            previewSpan.style.fontWeight = 'bold';
            previewSpan.style.background = 'none';
            previewSpan.style.webkitTextFillColor = 'initial';
        }

        customRoleModal.hide();
    });

    // Initialize preview
    updatePreview();
});

// Form validation
document.querySelector('.add-player-form').addEventListener('submit', function(e) {
    const nickname = document.querySelector('input[name="nickname"]').value.trim();
    const wins = parseInt(document.querySelector('input[name="wins"]').value) || 0;
    const games = parseInt(document.querySelector('input[name="games_played"]').value) || 0;

    if (!nickname) {
        e.preventDefault();
        alert('–ù–∏–∫–Ω–µ–π–º –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è!');
        return;
    }

    if (wins > games) {
        e.preventDefault();
        alert('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–±–µ–¥ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä!');
        return;
    }
});

// Toggle custom role field (kept for compatibility if JS above fails)
function toggleCustomRole() {
    const roleSelect = document.getElementById('role');
    const customRoleField = document.getElementById('customRoleField');
    const customRoleBtn = document.getElementById('customRoleBtn');

    if (roleSelect.value === 'custom') {
        customRoleBtn.style.display = 'inline-block';
        customRoleField.style.display = 'block';
    } else {
        customRoleBtn.style.display = 'none';
        customRoleField.style.display = 'none';
    }
}

// Animate cards
document.querySelectorAll('.admin-stat-card, .action-card').forEach((card, index) => {
    setTimeout(() => {
        card.style.animation = 'fadeInUp 0.6s ease';
    }, index * 100);
});

// Update K/D ratio color based on win rate
function updateWinRateColor() {
    document.querySelectorAll('tbody tr').forEach(row => {
        const kdCell = row.querySelector('td:nth-child(4) span');
        if (kdCell) {
            const kdRatio = parseFloat(kdCell.textContent);
            if (kdRatio < 0.3) {
                kdCell.className = 'stat-value text-danger';
            } else if (kdRatio < 0.5) {
                kdCell.className = 'stat-value text-warning';
            } else {
                kdCell.className = 'stat-value text-success';
            }
        }
    });
}
updateWinRateColor(); // Initial call
</script>
{% endblock %}